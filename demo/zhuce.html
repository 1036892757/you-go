<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="../css/head.css">
    <link rel="stylesheet" href="../font_1795546_0d28di0steg/iconfont.css">
    <link rel="stylesheet" href="../css/zhuce.css">
</head>

<body>
    <!-- 公共头部 -->
    <div class="head">
        <div class="headwarp">

            <ul class="headleft">
                <li>
                    <a href="" target="blank">关注</a>
                    <div class="abs">
                        <img src="../img/x22.jpg" alt="">
                        <span>关注公众号</span>
                    </div>
                </li>
                <li>
                    <a href="" target="blank">下载App</a>
                    <div class="abs1">
                        <img src="../img/app.jpg" alt="">
                        <span>优购app下载</span>
                    </div>
                </li>
            </ul>
            <ul class="headright">
                <li class="firstli">
                    <a href="#" target="blank">注册</a>
                    /
                    <a href="#" target="blank">登录</a>
                </li>
                <li>
                    <a href="#" target="blank">
                        <i class="iconfont icon-shoucang "></i>
                        <span>收藏</span>
                    </a>
                </li>
                <li>
                    <a href="#" target="blank">
                        <i class="iconfont icon-gouwudai"></i>
                        <span>购物袋</span>
                    </a>
                </li>
                <li class="lastli">
                    <a href="#" target="blank">公告</a>
                    <div>
                        <ul>
                            <li>
                                <a href="" target="blank">
                                    近期物流情况安排通知
                                </a>
                            </li>
                            <li>
                                <a href="" target="blank">
                                    优购客服电话变更
                                </a>
                            </li>
                            <li>
                                <a href="" target="blank">
                                    关闭分享购频道
                                </a>
                            </li>
                            <li>
                                <a href="" target="blank">
                                    提醒会员谨防诈骗电话
                                </a>
                            </li>
                        </ul>
                    </div>
                </li>
            </ul>
        </div>
    </div>
    <div class="header-gou">
        <div class="header-gou-1">
            <ul>
                <li>
                    <a href=""><img src="../img/signin-register-logo.png" /></a>
                </li>
                <li>
                    <span>用户登录</span>
                </li>
            </ul>

        </div>
    </div>
    <div class="BG-img">
        <div class="BG-img-1">
            <div class="nreg_zc fr">
                <ul class="tab_head">
                    <li><a href="denglu.html">登录</a></li>
                    <li><a href="zhuce.html">注册</a></li>
                </ul>
                <div class="nreg_form1">
                    <dl class="nreg_iphone">
                        <dd>
                            <div class="nreg_input_bg-2">
                                <label><span>手机号</span></label>
                                <input type="text" name="" id="" class="nreg_input" placeholder="请输入您的手机号" />
                            </div>
                        </dd>
                        <dt class="nreg_input_dt">
                            <div>

                            </div>
                        </dt>
                    </dl>
                    <dl class="nreg_yanz">
                        <dd>
                            <div class="nreg_input_bg-3">
                                <label><span>验证码</span></label>
                                <input type="text" name="" id="" class="nreg_input-2" />
                            </div>
                            <div class="input_yanz">
                                <img src="../img/imageCaptcha.png" alt="">
                            </div>
                        </dd>
                        <dt class="nreg_input_dt-2">
                            <div>

                            </div>
                        </dt>
                    </dl>
                    <dl class="shoujiyanz">
                        <dd>
                            <div class="sjyz1">
                                <label for="" class="sjlab">短信验证码</label>
                                <input type="text" class="sjinp">
                            </div>
                            <div class="fr">
                                  <a class="send">
                                      <span>获取验证码</span>
                                  </a>
                            </div>
                        </dd>
                        <dt class="sjyz4">
                            <div>

                            </div>
                        </dt>
                    </dl>
                    <dl class="nreg_mima">
                        <dd>
                            <div class="nreg_input_bg-4">
                                <label><span>密码</span></label>
                                <input type="password" name="" id="" class="nreg_input-3"
                                    placeholder="字母、数字、符号均可，6-25个字符以内" />
                            </div>
                        </dd>
                        <dt class="nreg_input_dt-3">
                            <div>

                            </div>
                        </dt>
                    </dl>
                    <dl class="nreg_mimas">
                        <dd>
                            <div class="nreg_input_bg-5">
                                <label><span>再次确认密码</span></label>
                                <input type="password" name="" id="" class="nreg_input-4" placeholder="" />
                            </div>
                            
                        </dd>
                        <dt class="nreg_input_dt-4">
                            <div>

                            </div>
                        </dt>
                    </dl>
                    <p class="che-p">
                        <span>
                            <input type="checkbox" name="" id="" value="" checked="checked" />
                        </span>
                        <label>
                            "我已阅读并同意" <a href="https://www.yougou.com/help/registrationagreement.html">《优购会员注册协议》</a>
                        </label>
                    </p>
                    <p class="Que-inp">
                        <a target="_blank">
                            <input type="submit" name="" id="Savereg" value="确认并注册" />
                        </a>
                    <div class="Savenext">

                    </div>
                    </p>
                </div>
            </div>
        </div>
    </div>
    <div class="footer-t">
        <div class="footer-t-2">
            <p>
                Copyright © 2011-2014 Yougou Technology Co., Ltd.
                <a href="">粤ICP备09070608号-4</a> 增值电信业务经营许可证: <a href="">粤 B2-20090203</a>
            </p>
        </div>
    </div>
</body>
<script src="../js/jquery-3.2.1.min.js"></script>
<script src="../js/cookieTools.js"></script>
<script src="../js/yonghu.js"></script>
<form action=""></form>
<script>
    $(function () {
        //获取验证码
        let arr = ["8vm4","584c","am3d","6a73","76mb"]
        let imgarr = ["../img/yz01.png","../img/yz02.png","../img/yz03.png","../img/yz04.png","../img/yz05.png"]; 
        let index = -1; 
        getCode()
        var isRight = [0, 0, 0, 0, 0,0];
        

        //获取手机验证码
        function SendCode(){
            $.get(
                "../sms/api_demo/SmsDemo.php",
                {
                  "phoneNumber":$(".nreg_input").val()
                },(data)=>{
                    console.log(data)
                    data = JSON.parse(data)
                    if(data.Code=="OK"){
                        isRight[5] = 1
                        $(".sjyz4>div").html("发送成功");
                    }else{
                        isRight[5] = 0
                        $(".sjyz4>div").html("发送失败");
                    }
                    setTimeout(function(){
                        $(".sjyz4>div").html("");
                    },1000)
                }
          )
        }

        //获取验证码
        function getCode(){
            index = parseInt(Math.random()*arr.length);
            $(".input_yanz>img").prop("src",imgarr[index])
        }
       

       $(".send").click(function(){
           SendCode()
       })


        //手机号
        $(".nreg_input").blur(function () {
            userId()
            if (isRight[0] == 1) {
                reg1()
            }
        })
        //验证码
        $(".nreg_input-2").blur(function () {
            if ($(".nreg_input-2").val() != arr[index] ) {
                $(".nreg_input_dt-2>div").html("验证码错误！")
                getCode()
                isRight[1] = 0;
            }else {
                isRight[1] = 1;
                $(".nreg_input_dt-2>div").html("验证码正确！")
            }
        })
        
        //密码
        $(".nreg_input-3").blur(function () {
            passId()
        }).change(function () {
            isRight[3] = 0;
            pass2Id()
        })

        //再次确认密码
        $(".nreg_input-4").blur(function () {
            pass2Id()
        })
        

        //验证码点击的时候切换
        $(".input_yanz>img").click(function(){
            getCode()
        })
         
        
        //1.手机号码的正则验证
        function userId() {
            //11位手机号 第一位不能为0 
            var reg = /^1[3456789]\d{9}$/;
            if (reg.test($(".nreg_input").val())) {
                isRight[0] = 1;
                $(".nreg_input_dt>div").html("手机号正确！");
            } else {
                isRight[0] = 0;
                $(".nreg_input_dt>div").html("手机号格式错误！");
            }
        }
        

        //2.密码的正则验证
        function passId() {
            //数字字母符号均可 6-25位
            var reg = /^[\dA-Za-z!@#$%^&*()_]{6,25}$/;
            if (reg.test($(".nreg_input-3").val())) {
                isRight[2] = 1;
                $(".nreg_input_dt-3>div").html("密码可以使用！")
            } else {
                isRight[2] = 0;
                $(".nreg_input_dt-3>div").html("密码格式错误！")
            }
        }
       
       //3.验证重复密码是否正确
        function pass2Id() {
            //数字字母符号均可 6-25位
            var reg = /^[\dA-Za-z!@#$%^&*()_]{6,25}$/;
            if (reg.test($(".nreg_input-4").val())) {
                isRight[3] = 1;
                $(".nreg_input_dt-4>div").html()
            } else {
                isRight[3] = 0;
                $(".nreg_input_dt-4>div").html("密码格式错误！")
            }

            if ($(".nreg_input-4").val() == $(".nreg_input-3").val()) {
                isRight[3] = 1;
                $(".nreg_input_dt-4>div").html("密码一致")
            } else {
                isRight[3] = 0;
                $(".nreg_input_dt-4>div").html("密码不一致")
            }
        }

        //验证有户名是否存在！
        function reg1() {
            $.get(
                "../checkUser1.php",
                { "username": $(".nreg_input").val() },
                (str) => {
                    if (str == "1") {
                        isRight[4] = 0
                        $(".nreg_input_dt>div").html("手机号已注册！");
                        getCode()
                    } else if (str == "0") {
                        isRight[4] = 1;
                        $(".nreg_input_dt>div").html("手机号可以使用！")
                    }
                }
            )
        }
         
        

        

        //点击注册功能！
        $("#Savereg").click(function () {
            if ($(".nreg_input").val() == "") {
                alert("用户名不能为空");
                getCode()
                return false;
            }
            if ($(".nreg_input-2").val() == "") {
                alert("验证码不能为空")
                getCode()
                return false;
            }
            if ($(".nreg_input-2").val() != arr[index] ) {
                alert("验证码错误")
                getCode()
                return false;
            }
            if ($(".nreg_input-3").val() == "") {
                alert("密码不能为空")
                getCode()
                return false;
            }
            if ($(".nreg_input-4").val() == "") {
                alert("重复密码不能为空")
                getCode()
                return false;
            }

            let sum = 0;
            isRight.forEach(item => {
                sum += item
            })
            if (sum == 6) {
                $.post(
                    "../regSave.php",
                    { "username": $(".nreg_input").val(), 
                      "userpass": $(".nreg_input-3").val(),
                       "sjinp":$(".sjinp").val()
                    },
                    (str) => {
                        if(str=="codefail"){
                            $(".sjyz4>div").html("短信验证码错误");
                        }else if (str == "1") {
                            $(".Savenext").html("注册成功！请登录！");
                            location.href = "denglu.html"
                        } else if (str == "0") {
                            $(".Savenext").html("注册失败！请重新注册！");
                            getCode()
                        }
                    }
                )
            } else {
                $(".Savenext").html("注册失败！还有信息没有填写！");
            }
        })

        
        


       


       


      
    })
</script>

</html>